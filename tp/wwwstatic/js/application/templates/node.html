<% $.each(models, function (k, model) { %>
    <header><h3>Node Details</h3></header>
    <section>
        <div  class="well">
            <table class="table table-bordered table-condensed table-hover noMargin">
                <tr>
                    <th>Node IP:</th><td><% print(model.get('ip')); %></td>
                </tr>
                <tr>
                    <th>Hostname:</th><td><% print(model.get('host/name')); %></td>
                </tr>
                <tr>
                    <th>Host Status:</th><td><% print(model.get('host/status')); %></td>
                </tr>
                <tr>
                    <th>Agent Status:</th><td><% print(model.get('agent/status')); %></td>
                </tr>
                <tr>
                    <th>Operating System:</th><td><% print(model.get('os/name')); %></td>
                </tr>
            </table>
        </div>
    </section>
    <header><h4>Patches Available</h4></header>
    <section>
        <div class="well">
            <% if(model.get("patch/need").length != 0) { %>
                <form action="/submitForm" method="post">
                    <table class="table table-bordered table-condensed table-hover noMargin">
                        <thead>
                            <tr>
                                <td>
                                    <label class="checkbox">
                                        <input type="checkbox" onclick="toggleChecked(this);">Select / Deselect All
                                    </label>
                                </td>
                                <td colspan="2">
                                    <span class="pull-right">
                                        <label>
                                            Operation
                                        </label>
                                        <select name="operation">
                                            <option value="install">Install</option>
                                            <option value="hide">Hide</option>
                                        </select>
                                        <label>
                                            <input type="hidden" value="<% print(model.get('id')); %>" name="node">
                                            <input type="submit" value="Submit">
                                        </label>
                                    </span>
                                </td>
                            </tr>
                        </thead>
                        <tbody>
                            <% $.each(model.get("patch/need"), function (i, patch) { %>
                                <tr>
                                    <td><input type="checkbox" id="<%= patch %>" name="patches" value="<%= patch %>"></td><th>Patch ID:</th><td><%= patch %></td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </form>
            <% }  else { %>
                <h6>No patches to display</h6>
            <% } %>
        </div>
    </section>
    <header><h4>Patches Done</h4></header>
    <section>
        <div class="well">
            <% if(model.get("patch/done").length != 0) { %>
            <form action="/submitForm" method="post">
                <table class="table table-bordered table-condensed table-hover noMargin">
                    <thead>
                        <tr>
                            <td>
                                <label class="checkbox">
                                    <input type="checkbox" onclick="toggleChecked(this);"/>Select / Deselect All
                                </label>
                            </td>
                            <td colspan="2">
                                <span class="pull-right">
                                    <label>
                                        Operation
                                    </label>
                                    <select name="operation">
                                        <option value="uninstall">Uninstall</option>
                                        <option value="hide">Hide</option>
                                    </select>
                                    <label>
                                        <input type="hidden" value="<% print(model.get('id')); %>" name="node">
                                        <input type="submit" value="Submit">
                                    </label>
                                </span>
                            </td>
                        </tr>
                    </thead>
                    <tbody>
                        <% $.each(model.get("patch/done"), function (i, patch) { %>
                            <tr>
                                <td><input type="checkbox" id="<%= patch %>" name="patches" value="<%= patch %>"></td><th>Patch ID:</th><td><%= patch %></td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </form>
            <% }  else { %>
                <h6>No patches to display</h6>
            <% } %>
        </div>
    </section>
    <header><h4>Patches Pending</h4></header>
    <section>
        <div class="well">
            <% if(model.get("patch/pend").length != 0) { %>
            <table class="table table-bordered table-condensed table-hover noMargin">
                <tbody>
                    <% $.each(model.get("patch/pend"), function (i, patch) { %>
                        <tr>
                            <th>Patch ID:</th><td><%= patch %></td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
            <% }  else { %>
                <h6>No patches to display</h6>
            <% } %>
        </div>
    </section>
    <header><h4>Patches Failed</h4></header>
    <section>
        <div class="well">
            <% if(model.get("patch/fail").length != 0) { %>
            <form action="/submitForm" method="post">
                <table class="table table-bordered table-condensed table-hover noMargin">
                    <thead>
                        <tr>
                            <td>
                                <label class="checkbox">
                                    <input type="checkbox" onclick="toggleChecked(this);"/>Select / Deselect All
                                </label>
                            </td>
                            <td colspan="2">
                                <span class="pull-right">
                                    <label>
                                        Operation
                                    </label>
                                    <select name="operation">
                                        <option value="install">Reinstall</option>
                                        <option value="hide">Hide</option>
                                    </select>
                                    <label>
                                        <input type="hidden" value="<% print(model.get('id')); %>" name="node">
                                        <input type="submit" value="Submit">
                                    </label>
                                </span>
                            </td>
                        </tr>
                    </thead>
                    <tbody>
                        <% $.each(model.get("patch/fail"), function (i, patch) { %>
                            <tr>
                                <td><input type="checkbox" id="<%= patch %>" name="patches" value="<%= patch %>"></td><th>Patch ID:</th><td><%= patch %></td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </form>
            <% }  else { %>
                <h6>No patches to display</h6>
            <% } %>
        </div>
    </section>
    <script>
        function toggleChecked(el) {
            var status = el.checked,
            form = $(el).parents('form');
           $(form).find(":checkbox").each( function() {
                $(this).attr("checked", status);
            });
        }
        $('form').submit(function (e) {
           var fields = $(this).find('input[name="patches"]:checked');
            if (!fields.length) {
                alert('Please select at least one patch');
                return false;
            }
        });
    </script>
<% }); %>