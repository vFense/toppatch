<% $.each(models, function (k, model) { %>
    <article>
        <header><strong>Node Details</strong></header>
        <section class="well clearfix">
            <dl>
                <dt>Node IP:</dt><dd><% print(model.get('ip')); %></dd>
                <dt>Hostname:</dt><dd><% print(model.get('host/name')); %></dd>
                <dt>Host Status:</dt><dd><% if(model.get('host/status') == true && model.get('reboot') == false) { print('Running &nbsp;<i style="color: green;" class="icon-ok"></i>'); } else if(model.get('reboot') == true) { print('Reboot required <i style="color: orange;" class="icon-warning-sign"></i>&nbsp;<button id="reboot" style="color: black;" class="btn btn-mini btn-warning">Reboot</button>'); } else { print('Stopped &nbsp;<i style="color: red;" class="icon-warning-sign"></i>') } %></dd>
                <dt>Agent Status:</dt><dd><% if(model.get('agent/status') == true) { print('Running &nbsp;<i style="color: green;" class="icon-ok"></i>'); } else { print('Stopped &nbsp;<i style="color: red;" class="icon-warning-sign"></i>') } %></dd>
                <dt>Operating System:</dt><dd><% print(model.get('os/name')); %></dd>
            </dl>
        </section>
    </article>
    <article>
        <header><strong>Patches Available</strong></header>
        <% if(model.get('patch/need').length != 0) { %>
        <section class="list">
            <form action="/submitForm" method="post" class="form-inline">
                <header class="clearfix">
                    <label class="checkbox inline">
                        <input type="checkbox" class="toggle-all">Select / Deselect All
                    </label>
                    <div class="pull-right noMargin">
                        <select type="button" class="btn btn-mini" name="operation">
                            <option value="install">Install</option>
                            <option value="hide">Hide</option>
                        </select>
                        <input type="submit" class="btn btn-mini btn-primary" value="Submit">
                    </div>
                    <input type="hidden" value="<% print(model.id); %>" name="node">
                </header>
                <% _.each(model.get('patch/need'), function (patch, i) { %>
                <div class="item clearfix">
                        <span class="desc">
                            <label class="checkbox inline">
                                <input type="checkbox" id="<%= patch %>" name="patches" value="<%= patch %>">
                                Patch ID: <%= patch %>
                            </label>
                        </span>
                        <span class="pull-right">
                            <a href="#patches/<%= patch %>">More information</a>
                        </span>
                </div>
                <% }); %>
            </form>
        </section>
        <% }  else { %>
        <section class="list">
            <div class="item">
                <small><em>No patches to display</em></small>
            </div>
        </section>
        <% } %>
    </article>
    <article>
        <header><strong>Patches Done</strong></header>
        <% if(model.get('patch/done').length != 0) { %>
        <section class="list">
            <form action="/submitForm" method="post" class="form-inline">
                <header class="clearfix">
                    <label class="checkbox inline">
                        <input type="checkbox" class="toggle-all">Select / Deselect All
                    </label>
                    <div class="pull-right noMargin">
                        <select type="button" class="btn btn-mini" name="operation">
                            <option value="uninstall">Uninstall</option>
                            <option value="hide">hide</option>
                        </select>
                        <input type="submit" class="btn btn-mini btn-primary disabled" value="Submit">
                    </div>
                    <input type="hidden" value="<% print(model.id); %>" name="node">
                </header>
                <% _.each(model.get('patch/done'), function (patch, i) { %>
                <div class="item clearfix">
                        <span class="desc">
                            <label class="checkbox inline">
                                <input type="checkbox" id="<%= patch %>" name="patches" value="<%= patch %>">
                                Patch ID: <%= patch %>
                            </label>
                        </span>
                        <span class="pull-right">
                            <a href="#patches/<%= patch %>">More information</a>
                        </span>
                </div>
                <% }); %>
            </form>
        </section>
        <% }  else { %>
        <section class="list">
            <div class="item">
                <small><em>No patches to display</em></small>
            </div>
        </section>
        <% } %>
    </article>
    <article>
        <header><strong>Patches Pending</strong></header>
        <% if(model.get('patch/pend').length != 0) { %>
        <section class="list">
            <% _.each(model.get('patch/pend'), function (patch, i) { %>
            <div class="item clearfix">
                    <span class="desc">
                        <label class="checkbox inline">
                            <input type="checkbox" id="<%= patch %>" name="patches" value="<%= patch %>">
                            Patch ID: <%= patch %>
                        </label>
                    </span>
                    <span class="pull-right">
                        <a href="#patches/<%= patch %>">More information</a>
                    </span>
            </div>
            <% }); %>
        </section>
        <% }  else { %>
        <section class="list">
            <div class="item">
                <small><em>No patches to display</em></small>
            </div>
        </section>
        <% } %>
    </article>
    <article>
        <header><strong>Patches Failed</strong></header>
        <% if(model.get('patch/fail').length != 0) { %>
        <section class="list">
            <form action="/submitForm" method="post" class="form-inline">
                <header class="clearfix">
                    <label class="checkbox inline">
                        <input type="checkbox" class="toggle-all">Select / Deselect All
                    </label>
                    <div class="pull-right noMargin">
                        <select type="button" class="btn btn-mini" name="operation">
                            <option value="uninstall">Uninstall</option>
                            <option value="hide">hide</option>
                        </select>
                        <input type="submit" class="btn btn-mini btn-primary disabled" value="Submit">
                    </div>
                    <input type="hidden" value="<% print(model.id); %>" name="node">
                </header>
                <% _.each(model.get('patch/fail'), function (patch, i) { %>
                <div class="item clearfix">
                        <span class="desc">
                            <label class="checkbox inline">
                                <input type="checkbox" id="<%= patch %>" name="patches" value="<%= patch %>">
                                Patch ID: <%= patch %>
                            </label>
                        </span>
                        <span class="pull-right">
                            <a href="#patches/<%= patch %>">More information</a>
                        </span>
                </div>
                <% }); %>
            </form>
        </section>
        <% }  else { %>
        <section class="list">
            <div class="item">
                <small><em>No patches to display</em></small>
            </div>
        </section>
        <% } %>
    </article>
    <script>
        $('.toggle-all').click(function(el){
            var status = el.target.checked,
                    form = $(el.target).parents('form');
            $(form).find(":checkbox").each( function() {
                $(this).attr("checked", status);
            });
        });
        function toggleChecked(el) {
            var status = el.checked,
            form = $(el).parents('form');
           $(form).find(":checkbox").each( function() {
                $(this).attr("checked", status);
            });
        }
        $('form').submit(function (e) {
           var fields = $(this).find('input[name="patches"]:checked');
            if (!fields.length) {
                alert('Please select at least one patch');
                return false;
            }
        });
    </script>
<% }); %>