<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <title>TopPatch App</title>
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="viewport" content="width=device-width">
    <link href='http://fonts.googleapis.com/css?family=Cantarell:700|Open+Sans:400,600' rel='stylesheet'>
    <link rel="stylesheet" href="../css/appName.css">
    <link rel="stylesheet" href="../css/bootstrap.css">
    <link rel="stylesheet" href="../js/libs/jquery-ui-1.8.22.custom/css/ui-lightness/jquery-ui-1.8.22.custom.css">
    <script src="../js/libs/Modernizr/modernizr-2.5.3-respond-1.1.0.min.js"></script>
    <style>
        .window {
            -moz-border-radius: 15px;
            border-radius: 15px;
            border: 4px solid #E0E0E0;
            background-color: white;
            padding: 5px;
        }
        #widgetProperties {
            overflow-y: auto !important;
        }
        .point {
            fill: rgb(51, 156, 255);
            stroke-width: 2px;
            stroke: rgb(255,255,255);
        }
        .point.max {
            fill: rgb(200,0,0);
            stroke-width: 2px;
        }
        .chart {
             display: block;
             margin: auto;
             margin-top: 60px;
             font-size: 11px;
         }

        rect {
            stroke: #eee;
            fill: #aaa;
            fill-opacity: .8;
        }

        rect.parent {
            cursor: pointer;
            fill: steelblue;
        }

        text {
            pointer-events: none;
        }
    </style>
</head>
<body>
<noscript>
    <div class="title">JavaScript is required.</div>
    <div class="subtitle">To use TopPatch, enable JavaScript in your browser and try again.</div>
    <hr/>
    <div class=""><a href="http://www.toppatch.com/"><img src="../img/logo-text.png" class="logo-text" alt="Top Patch logo"/></a></div>
</noscript>
<!--
<header class="pageHeader">
    <section class="navbar container">
        <div class="navbar-inner noBorder noRadius noShadow" id="primaryNav">
            <nav class="clearfix">
                <a class="brand" href="#" style="color: #223666">
                    <img src="../img/brand-name.png" alt="Top Patch brand"/> | Remediation Vault
                </a>
                <ul class="nav pull-right">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <i class="icon-user"></i><span> Username </span><i class="icon-caret-down"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="javascript:;">My Profile</a></li>
                            <li class="divider"></li>
                            <li><a href="javascript:;">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
        <div class="navbar-inner">
            <nav class="clearfix">
                <ul class="nav">
                    <li class="dropdown" role="menu" aria-labeledby="dlabel">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <span> Admin </span><i class="icon-caret-down"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li class="dropdown-submenu">
                                <a tabindex="-1" href="#">Patching</a>
                                <ul class="dropdown-menu">
                                    <li><a tabindex="-1" href="#" id="deploy">Deploy Patches</a></li>
                                    <li><a tabindex="-1" href="#">Second Level Link</a></li>
                                    <li><a tabindex="-1" href="#">Second Level Link</a></li>
                                    <li><a tabindex="-1" href="#">Second Level Link</a></li>
                                    <li><a tabindex="-1" href="#">Second Level Link</a></li>
                                </ul>
                            </li>
                            <li><a href="javascript:;">Option 2</a></li>
                            <li><a href="javascript:;">Option 3</a></li>
                        </ul>
                    </li>
                </ul>
                <ul class="nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <i class="icon-file"></i><span> Reports </span><i class="icon-caret-down"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="javascript:;">Basic Report</a></li>
                            <li><a href="javascript:;">Generic Report 2</a></li>
                            <li><a href="javascript:;">Generic Report 3</a></li>
                        </ul>
                    </li>
                </ul>
                <ul class="nav pull-right">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <i class="icon-cog"></i><span>Settings </span><b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="#" id="restore">Restore Defaults</a></li>
                            <li><a href="#widgetProperties" data-toggle="modal" id="addwidget" onclick="setProperties(this, 'new');">Add Widget</a></li>
                            <li><a href="#">Account Settings</a></li>
                            <li class="divider"></li>
                            <li><a href="#">Help</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
    </section>
</header>
-->
<header id="pageHeader">
    <section class="navbar container">
        <div class="navbar-inner noBorder noRadius noShadow" id="primaryNav">
            <nav class="clearfix">
				<span class="brand">
					<a href="#"><img src="../img/brand-name.png" alt="Top Patch brand"/></a> | R<small>emediation</small> V<small>ault</small>
				</span>
                <ul class="nav pull-right" id="account-dropdown">&nbsp;</ul>
            </nav>
        </div>
        <div class="navbar-inner" id="dashboardNav">&nbsp;</div>
    </section>
</header>
<!--[if lt IE 7]<section class="container"><div class="alert alert-error chromeframe" id="ie-warning"><a class="close" data-dismiss="alert">×</a><strong>Top Patch does not support your browser.</strong> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</div></section><![endif]-->
<section class="container" role="main" id="main">
    <header class="page-header">
        <h1>DASHBOARD <small>Customize your needs</small></h1>
    </header>
    <summary class="row-fluid clearfix movable">
        <!--
        <div class="span3">
            <div class="widget number">
                <h4>Nodes</h4>10,007
            </div>
        </div>
        <div class="span3">
            <div class="widget number">
                <h4>Patched Today</h4>3,096
            </div>
        </div>
        <div class="span3">
            <div class="widget number">
                <h4>Unpatched</h4>537
            </div>
        </div>
        <div class="span3 error">
            <div class="widget number">
                <h4>Failed Patches</h4>3
            </div>
        </div> -->
        <dl class="span3 info">
            <dt>Nodes</dt>
            <dd>10000</dd>
        </dl>
        <dl class="span3 success">
            <dt>Patched</dt>
            <dd>3207</dd>
        </dl>
        <dl class="span3 warning">
            <dt>Scheduled Patches</dt>
            <dd>508</dd>
        </dl>
        <dl class="span3 error">
            <dt>Failed Patches</dt>
            <dd>3</dd>
        </dl>
    </summary>
    <summary id="container" class="row-fluid movable">
        <div id="widget1" class="span4 widget">
            <div id="graphcontainer" class="window">
                <header style="position: relative;">
                    <h2 id="widget1-title">OS in Networks</h2>
                    <div id="menu1" class="dropdown pull-right" style="position: absolute; top: 0; right: 5px; line-height: 36px;">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#menu1"><i class="icon-list-ul"></i></a>
                        <ul class="dropdown-menu">
                            <li><a href="#" class="remove" onclick="hideWidget(this);">Hide</a></li>
                            <li><a data-toggle="modal" href="#widgetProperties" onclick="setProperties(this, 'existing');">Properties</a></li>
                            <li><a href="#">Something else here</a></li>
                            <li class="divider"></li>
                            <li><a href="#">Separated link</a></li>
                        </ul>
                    </div>
                </header>
                <div id="graph1" class="graph"></div>
                <!--<img src="http://placehold.it/300x200"/> -->
            </div>
        </div>
        <div id="widget2" class="span6 widget">
            <div id="graph2container" class="window">
                <header style="position: relative;">
                    <h2 id="widget2-title">Vulnerabilities by Nodes</h2>
                    <div id="menu2" class="dropdown pull-right" style="position: absolute; top: 0; right: 5px; line-height: 36px;">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#menu2"><i class="icon-list-ul"></i></a>
                        <ul class="dropdown-menu">
                            <li><a href="#" class="remove" onclick="hideWidget(this);">Hide</a></li>
                            <li><a href="#widgetProperties" data-toggle="modal" onclick="setProperties(this, 'existing');">Properties</a></li>
                            <li><a href="#">Something else here</a></li>
                            <li class="divider"></li>
                            <li><a href="#">Separated link</a></li>
                        </ul>
                    </div>
                </header>
                <div id="graph2" class="graph"></div>
                <!--<img src="http://placehold.it/620x200"/>-->
            </div>
        </div>
    </summary>
    <summary class="row-fluid movable">
        <div id="widget3" class="span12 widget">
            <div id="graph3container" class="window">
                <header style="position: relative;">
                    <h2 id="widget3-title">Vulnerabilities by Time</h2>
                    <div id="menu3" class="dropdown pull-right" style="position: absolute; top: 0; right: 5px; line-height: 36px;">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#menu3"><i class="icon-list-ul"></i></a>
                        <ul class="dropdown-menu">
                            <li><a href="#" class="remove" onclick="hideWidget(this);">Hide</a></li>
                            <li><a href="#widgetProperties" data-toggle="modal" onclick="setProperties(this, 'existing');">Properties</a></li>
                            <li><a href="#">Something else here</a></li>
                            <li class="divider"></li>
                            <li><a href="#">Separated link</a></li>
                        </ul>
                    </div>
                </header>
                <div id="graph3" class="graph"></div>
                <!--<img src="http://placehold.it/620x200"/>-->
            </div>
        </div>
    </summary>
    <summary id="insert" class="row-fluid movable"></summary>
    <br />
    <summary class="row-fluid movable">
        <div class="span12 widget">
            <header>
                <h2>Widget Title</h2>
            </header>
            <table id="data" class="table table-bordered table-striped"></table>
            <div class="pagination pagination-centered">
                <ul>
                    <li><a href="#">Prev</a></li>
                    <li class="active">
                        <a href="#">1</a>
                    </li>
                    <li><a href="#">2</a></li>
                    <li><a href="#">3</a></li>
                    <li><a href="#">4</a></li>
                    <li><a href="#">Next</a></li>
                </ul>
            </div>
        </div>
    </summary>
</section>
<div class="modal hide" id="widgetProperties">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">×</button>
        <h3>Widget Properties</h3>
    </div>
    <div class="modal-body">
        <h4>Choose a widget</h4>
        <div id="type">
            <input type="radio" name="type" id="type1"  value="graph" /><label for="type1">Graph</label>
            <input type="radio" name="type" id="type2" value="text" /><label for="type2">Text</label>
        </div>
        <div id="textSettings" class="hide">
            <h4>Choose a parameter</h4>
            <div id="parameter">
                <input type="radio" name="param" id="param1"  value="Nodes"/><label for="param1">Nodes</label>
                <input type="radio" name="param" id="param2" value="Patched" /><label for="param2">Patched</label>
                <input type="radio" name="param" id="param3" value="Scheduled Patches"/><label for="param3">Unpatched</label>
                <input type="radio" name="param" id="param4" value="Failed Patches"/><label for="param4">Failed</label>
            </div>
        </div>
        <div id="graphSettings" class="hide">
            <h4>Choose a size</h4>
            <div id="size">
                <input type="radio" name="radio" id="radio2"  value="3"/><label for="radio2">3</label>
                <input type="radio" name="radio" id="radio3" value="4" checked="checked"/><label for="radio3">4</label>
                <input type="radio" name="radio" id="radio4" value="6"/><label for="radio4">6</label>
                <input type="radio" name="radio" id="radio5" value="12"/><label for="radio5">12</label>
            </div>
            <h4>Choose type of graph</h4>
            <div id="graphType">
                <input type="radio" name="graph" id="graphtype1"  value="pie" /><label for="graphtype1">Pie Graph</label>
                <input type="radio" name="graph" id="graphtype2" value="bar" checked="checked"/><label for="graphtype2">Bar Graph</label>
                <input type="radio" name="graph" id="graphtype3" value="line"/><label for="graphtype3">Line Graph</label>
                <input type="radio" name="graph" id="graphtype4" value="time"/><label for="graphtype4">Time Series</label>
            </div>
            <div id="dataToGraph" class="hide">
                <h4>Choose type of Data</h4>
                <div id="graphdata">
                    <input type="radio" name="graphdata" id="graphdata1"  value="os" checked="checked"/><label for="graphdata1">OS in Network</label>
                    <input type="radio" name="graphdata" id="graphdata2" value="node"/><label for="graphdata2">Nodes by OS</label>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <a href="#" class="btn" data-dismiss="modal">Close</a>
        <a href="#" class="btn btn-primary" id="apply">Save changes</a>
    </div>
</div>
<footer class="pageFooter">
    <section class="container">
        <div class="row">
            <p class="span3"><img src="../img/brand-logo-name-tag.png" class="logo-text" alt="Top Patch logo"/></p>
            <p class="span9 legal">&copy; 2012 TopPatch Inc. All rights reserved.</p>
        </div>
    </section>
</footer>
<!--/container -->

<!-- javascript libraries -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="../js/libs/jquery-1.7.2.min.js"><\/script>')</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.0.4/bootstrap.min.js"></script>
<script src="http://documentcloud.github.com/underscore/underscore-min.js"></script>
<script src="http://backbonejs.org/backbone-min.js"></script>
<script src="../js/libs/shutterstock-rickshaw-c5eabaf/rickshaw.min.js"></script>
<script>
    // The typeahead constructor is the last constructor defined in bootstrap.js
    // If it exists then bootstrap.js has, most likely, loaded properly.
    $.fn.typeahead.Constructor || document.write('<script src="../js/libs/bootstrap/bootstrap.min.js"><\/script>');
</script>
<script src="../js/libs/jquery-ui-1.8.22.custom/js/jquery-ui-1.8.22.custom.min.js"></script>

<!--/javascript libraries -->

<!-- javascript chart libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/2.8.1/d3.v2.min.js"></script>
<script>window.d3 || document.write('<script src="../js/libs/charts/d3.v2.min.js"><\/script>')</script>
<script src="../js/libs/cubism.js"></script>
<!--
<script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script>window.Raphael || document.write('<script src="js/libs/charts/raphael-min.js"><\/script>')</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/graphael/0.5.0/g.raphael-min.js"></script>
<script>window.Raphael.g || document.write('<script src="js/libs/charts/g.raphael-min.js"><\/script>')</script>
-->
<!--/javascript chart libraries -->

<!-- Top Patch javascript -->
<script src="../js/application.min.js"></script>
<script src="../js/application/templates/templates.js"></script>
<script src="../js/appName_Segments/pieCharts.js"></script>
<script src="../js/appName_Segments/barCharts.js"></script>
<script src="../js/appName_Segments/timeSeriesChart.js"></script>
<script src="../js/appName_Segments/lineChart.js"></script>
<script src="../js/appName_Segments/stackedBarChart.js"></script>
<script src="../js/appName_Segments/interactiveGraph.js"></script>

<script>
    jQuery(document).ready(function($) {
        var table = $application.generateTable().headerRow(true)
                .sort(function (a, b) {
                    return a.score - b.score;
                });
        var data = [{"vendor":"mozilla","product":"firefox","version":"8.0:--:--","cveid":"CVE-2011-3658","score":"7.5"},{"vendor":"mozilla","product":"firefox","version":"8.0:--:--","cveid":"CVE-2012-0451","score":"4.3"},{"vendor":"mozilla","product":"firefox","version":"8.0:--:--","cveid":"CVE-2012-0454","score":"7.5"},{"vendor":"mozilla","product":"firefox","version":"8.0:--:--","cveid":"CVE-2012-0455","score":"4.3"},{"vendor":"mozilla","product":"firefox","version":"8.0:--:--","cveid":"CVE-2012-0456","score":"5.0"}];
        d3.select("#data").datum(data).call(table);
        /*
         d3.json("../test-ajax/proposed_data.json", function(data) {
         d3.select("#data")
         .datum(data)
         .call(table);
         });
         */
    });
</script>
<script type="text/javascript">
    function cubismGraph(selection) {
        var width = $(selection).width(),
            context = cubism.context()
                .serverDelay(0)
                .clientDelay(0)
                .step(1e3)
                .size(width);
        $(selection).html("");

        var foo = random("foo", context);
            //bar = random("bar", context);
        d3.select(selection).call(function(div) {

            div.append("div")
                    .attr("class", "axis")
                    .call(context.axis().orient("top"));

            div.selectAll(".horizon")
                    .data([foo])
                    .enter().append("div")
                    .attr("class", "horizon")
                    .call(context.horizon().title(function (d) { return "Number of vulnerabilities: "; }).extent([0,200]).height(220).mode("mirror"));

            div.append("div")
                    .attr("class", "rule")
                    .call(context.rule());

        });

        // On mousemove, reposition the chart values to match the rule.
        context.on("focus", function(i) {
            d3.selectAll(".value").style("right", i == null ? null : context.size() - i + "px");
        });
    }
    function random(name, context) {
        var value = 0,
                values = [],
                i = 0,
                last;

        return context.metric(function(start, stop, step, callback) {
            start = +start;
            stop = +stop;

            if (isNaN(last)) last = start;
            while (last < stop) {
                last += step;
                //value = Math.max(-10, Math.min(10, value + .8 * Math.random() - .4 + .2 * Math.cos(i += .2)));
                value = 50 - Math.random() * 21 - 10;
                values.push(value);
            }
            callback(null, values = values.slice((start - stop) / step));
        }, name);
    }
</script>
<script type="text/template" id="widget_template">
    <div id="<%= widget %>" class="<%= span %> widget">
        <div id="<%= graphcontainer %>" class="window">
            <header style="position: relative;">
                <h2 id="<%= widget %>-title">Widget Title</h2>
                <div id="<%= menu %>" class="dropdown pull-right" style="position: absolute; top: 0; right: 5px; line-height: 36px;">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#<%= menu %>"><i class="icon-list-ul"></i></a>
                    <ul class="dropdown-menu">
                        <li><a href="#" class="remove" onclick="hideWidget(this);">Hide</a></li>
                        <li><a data-toggle="modal" href="#widgetProperties" onclick="setProperties(this, 'existing');">Properties</a></li>
                        <li><a href="#">Something else here</a></li>
                        <li class="divider"></li>
                        <li><a href="#">Separated link</a></li>
                    </ul>
                </div>
            </header>
            <div id="<%= graph %>">
            </div>
        </div>
    </div>
</script>
<script type="text/template" id="text_template">
    <dl id="<%= widget %>" class="<%= span %> <%= type %>">
        <dt id="<%= widget %>-title">
            <%= title %>
        </dt>
        <dd>
            <%= data %>
        </dd>
    </dl>
</script>
<script type="text/template" id="patch_template">
    <header class="page-header">
        <h1>PATCH MANAGER <small>apply custom patches</small></h1>
    </header>
    <div class="pull-right form-inline">
        <label class="checkbox" for="selectAll">
            <input type="checkbox" id="selectAll" onclick="toggleChecked(this.checked);"/>Select / Deselect All
        </label>
        <button class="btn" type="submit" id="submitPatches" name="submitPatches">Next</button>
    </div>
    <table class="table table-bordered table-striped table-hover">
        <thead>
            <tr>
                <th>Name of <%= type %></th><th>Release date<th>options</th>
            </tr>
        </thead>
        <tbody>
        <% if(type === "patches") {
            for (var i = 0; i < 10; i ++) { %>
            <tr>
                <td>Patch Number <%= i %></td><td>Date: <%= i + i %></td><td><input id="patch<%= i %>" name="patch<%= i %>" type="checkbox" value="<%= i %>" /></td>
            </tr>
            <% }
        } else if(type === "nodes") {
            for (var i = 0; i < 10; i ++) { %>
            <tr>
                <td>Node: <%= i %></td><td>Date: <%= i + i %></td><td><input id="patch<%= i %>" name="patch<%= i %>" type="checkbox" value="<%= i %>"/></td>
            </tr>
            <% }
        } %>
        </tbody>
    </table>
    <table id="table" class="table table-bordered table-striped"></table>
    <script type="text/javascript">
        function toggleChecked(status) {
            $(":checkbox").each( function() {
                console.log(status);
                $(this).attr("checked", status);
            });
        }
        $("#submitPatches").click(function () {
            var variables = { type: "nodes" };
            var template = _.template($("#patch_template").html(), variables);
            $("#main").html(template);
        });
        /*
        var data = [{"vendor":"mozilla","product":"firefox","version":"8.0:--:--","cveid":"CVE-2011-3658","score":"7.5"},{"vendor":"mozilla","product":"firefox","version":"8.0:--:--","cveid":"CVE-2012-0451","score":"4.3"},{"vendor":"mozilla","product":"firefox","version":"8.0:--:--","cveid":"CVE-2012-0454","score":"7.5"},{"vendor":"mozilla","product":"firefox","version":"8.0:--:--","cveid":"CVE-2012-0455","score":"4.3"},{"vendor":"mozilla","product":"firefox","version":"8.0:--:--","cveid":"CVE-2012-0456","score":"5.0"}];
        var table = $application.generateTable().headerRow(true)
        .sort(function (a, b) {
        return a.score - b.score;
        });
        d3.select("#table").datum(data).call(table);
        */
        //alert(data);
    </script>
</script>
    <script>
    function pieGraph(selection, graphData) {
        var title;
        if (graphData === "os") {
            data = [{"label":"windows 7", "value": Math.floor(Math.random() * 100)},
                {"label":"windows 8", "value": Math.floor(Math.random() * 100)},
                {"label":"windows XP", "value": Math.floor(Math.random() * 100)},
                {"label":"Mac OS X", "value": Math.floor(Math.random() * 100)},
                {"label":"linux", "value": Math.floor(Math.random() * 100)}];
            title = "OS in Network";
        } else if (graphData === "node") {
            data = [{"label":"node 1", "value": Math.floor(Math.random() * 100)},
                {"label":"node 2", "value": Math.floor(Math.random() * 100)},
                {"label":"node 3", "value": Math.floor(Math.random() * 100)},
                {"label":"node 4", "value": Math.floor(Math.random() * 100)},
                {"label":"node 5", "value": Math.floor(Math.random() * 100)},
                {"label":"node 6", "value": Math.floor(Math.random() * 100)},
                {"label":"node 7", "value": Math.floor(Math.random() * 100)},
                {"label":"node 8", "value": Math.floor(Math.random() * 100)}];
            title = "Nodes by OS";
        }
        var pieChart = $application.pieChart().title(title);
        d3.select(selection).datum(data).call(pieChart);
    }
    function barGraph(selection) {
        var data = [{label: "vulnerable", value: Math.floor(Math.random() * 100)},
                    {label: "secure", value: Math.floor(Math.random() * 100)},
                    {label: "patched", value: Math.floor(Math.random() * 100)},
                    {label: "pending", value: Math.floor(Math.random() * 100)},
                    {label: "failed", value: Math.floor(Math.random() * 100)},
                    {label: "nodes", value: Math.floor(Math.random() * 100)}],
                title = "Vulnerabilities by Nodes",
        width = $(selection).width(),
        barWidth = (width / data.length ) - 10;
        var graphBar = $application.verticalBarChart().title(title).barWidth(barWidth);
        d3.select(selection).datum(data).call(graphBar);
    }
    function lineGraph(selection) {
        var data = [{"label": new Date('1960').getFullYear(), "value":60},
            {"label": new Date('1970').getFullYear(), "value":20},
            {"label": new Date('1980').getFullYear(), "value":43},
            {"label": new Date('1990').getFullYear(), "value":15},
            {"label": new Date('2000').getFullYear(), "value":5},
            {"label": new Date('2010').getFullYear(), "value":25},
            {"label": new Date('2012').getFullYear(), "value":65}],
            title = "Line Chart";
        var lineChart = $application.lineChart().title(title);
        d3.select(selection).datum(data).call(lineChart);
    }
    function stackedGraph(selection) {
        var data = [{"label":"windows 7", "value": Math.floor(Math.random() * 100)},
            {"label":"windows 8", "value": Math.floor(Math.random() * 100)},
            {"label":"windows XP", "value": Math.floor(Math.random() * 100)},
            {"label":"Mac OS X", "value": Math.floor(Math.random() * 100)},
            {"label":"linux", "value": Math.floor(Math.random() * 100)}];
        var title = "OS in Network";
        var width = $(selection).width();
        var stackedChart = $application.stackedVerticalChart().title(title).width(width);
        d3.select(selection).datum(data).call(stackedChart);
    }
    function interactiveGraph(selection) {
        var data = [{"label":"windows 7", "value": Math.floor(Math.random() * 100)},
            {"label":"windows 8", "value": Math.floor(Math.random() * 100)},
            {"label":"windows XP", "value": Math.floor(Math.random() * 100)},
            {"label":"Mac OS X", "value": Math.floor(Math.random() * 100)},
            {"label":"linux", "value": Math.floor(Math.random() * 100)}];
        var root =
            {
                "name": "flare",
                "children": [
                    {
                        "name": "analytics",
                        "children": [
                            {
                                "name": "cluster",
                                "children": [
                                    {"name": "AgglomerativeCluster", "size": 3938},
                                    {"name": "CommunityStructure", "size": 3812},
                                    {"name": "HierarchicalCluster", "size": 6714},
                                    {"name": "MergeEdge", "size": 743}
                                ]
                            },
                            {
                                "name": "graph",
                                "children": [
                                    {"name": "BetweennessCentrality", "size": 3534},
                                    {"name": "LinkDistance", "size": 5731},
                                    {"name": "MaxFlowMinCut", "size": 7840},
                                    {"name": "ShortestPaths", "size": 5914},
                                    {"name": "SpanningTree", "size": 3416}
                                ]
                            },
                            {
                                "name": "optimization",
                                "children": [
                                    {"name": "AspectRatioBanker", "size": 7074}
                                ]
                            }
                        ]
                    },
                    {
                        "name": "animate",
                        "children": [
                            {"name": "Easing", "size": 17010},
                            {"name": "FunctionSequence", "size": 5842},
                            {
                                "name": "interpolate",
                                "children": [
                                    {"name": "ArrayInterpolator", "size": 1983},
                                    {"name": "ColorInterpolator", "size": 2047},
                                    {"name": "DateInterpolator", "size": 1375},
                                    {"name": "Interpolator", "size": 8746},
                                    {"name": "MatrixInterpolator", "size": 2202},
                                    {"name": "NumberInterpolator", "size": 1382},
                                    {"name": "ObjectInterpolator", "size": 1629},
                                    {"name": "PointInterpolator", "size": 1675},
                                    {"name": "RectangleInterpolator", "size": 2042}
                                ]
                            },
                            {"name": "ISchedulable", "size": 1041},
                            {"name": "Parallel", "size": 5176},
                            {"name": "Pause", "size": 449},
                            {"name": "Scheduler", "size": 5593},
                            {"name": "Sequence", "size": 5534},
                            {"name": "Transition", "size": 9201},
                            {"name": "Transitioner", "size": 19975},
                            {"name": "TransitionEvent", "size": 1116},
                            {"name": "Tween", "size": 6006}
                        ]
                    },
                    {
                        "name": "data",
                        "children": [
                            {
                                "name": "converters",
                                "children": [
                                    {"name": "Converters", "size": 721},
                                    {"name": "DelimitedTextConverter", "size": 4294},
                                    {"name": "GraphMLConverter", "size": 9800},
                                    {"name": "IDataConverter", "size": 1314},
                                    {"name": "JSONConverter", "size": 2220}
                                ]
                            },
                            {"name": "DataField", "size": 1759},
                            {"name": "DataSchema", "size": 2165},
                            {"name": "DataSet", "size": 586},
                            {"name": "DataSource", "size": 3331},
                            {"name": "DataTable", "size": 772},
                            {"name": "DataUtil", "size": 3322}
                        ]
                    },
                    {
                        "name": "display",
                        "children": [
                            {"name": "DirtySprite", "size": 8833},
                            {"name": "LineSprite", "size": 1732},
                            {"name": "RectSprite", "size": 3623},
                            {"name": "TextSprite", "size": 10066}
                        ]
                    },
                    {
                        "name": "flex",
                        "children": [
                            {"name": "FlareVis", "size": 4116}
                        ]
                    },
                    {
                        "name": "physics",
                        "children": [
                            {"name": "DragForce", "size": 1082},
                            {"name": "GravityForce", "size": 1336},
                            {"name": "IForce", "size": 319},
                            {"name": "NBodyForce", "size": 10498},
                            {"name": "Particle", "size": 2822},
                            {"name": "Simulation", "size": 9983},
                            {"name": "Spring", "size": 2213},
                            {"name": "SpringForce", "size": 1681}
                        ]
                    },
                    {
                        "name": "query",
                        "children": [
                            {"name": "AggregateExpression", "size": 1616},
                            {"name": "And", "size": 1027},
                            {"name": "Arithmetic", "size": 3891},
                            {"name": "Average", "size": 891},
                            {"name": "BinaryExpression", "size": 2893},
                            {"name": "Comparison", "size": 5103},
                            {"name": "CompositeExpression", "size": 3677},
                            {"name": "Count", "size": 781},
                            {"name": "DateUtil", "size": 4141},
                            {"name": "Distinct", "size": 933},
                            {"name": "Expression", "size": 5130},
                            {"name": "ExpressionIterator", "size": 3617},
                            {"name": "Fn", "size": 3240},
                            {"name": "If", "size": 2732},
                            {"name": "IsA", "size": 2039},
                            {"name": "Literal", "size": 1214},
                            {"name": "Match", "size": 3748},
                            {"name": "Maximum", "size": 843},
                            {
                                "name": "methods",
                                "children": [
                                    {"name": "add", "size": 593},
                                    {"name": "and", "size": 330},
                                    {"name": "average", "size": 287},
                                    {"name": "count", "size": 277},
                                    {"name": "distinct", "size": 292},
                                    {"name": "div", "size": 595},
                                    {"name": "eq", "size": 594},
                                    {"name": "fn", "size": 460},
                                    {"name": "gt", "size": 603},
                                    {"name": "gte", "size": 625},
                                    {"name": "iff", "size": 748},
                                    {"name": "isa", "size": 461},
                                    {"name": "lt", "size": 597},
                                    {"name": "lte", "size": 619},
                                    {"name": "max", "size": 283},
                                    {"name": "min", "size": 283},
                                    {"name": "mod", "size": 591},
                                    {"name": "mul", "size": 603},
                                    {"name": "neq", "size": 599},
                                    {"name": "not", "size": 386},
                                    {"name": "or", "size": 323},
                                    {"name": "orderby", "size": 307},
                                    {"name": "range", "size": 772},
                                    {"name": "select", "size": 296},
                                    {"name": "stddev", "size": 363},
                                    {"name": "sub", "size": 600},
                                    {"name": "sum", "size": 280},
                                    {"name": "update", "size": 307},
                                    {"name": "variance", "size": 335},
                                    {"name": "where", "size": 299},
                                    {"name": "xor", "size": 354},
                                    {"name": "_", "size": 264}
                                ]
                            },
                            {"name": "Minimum", "size": 843},
                            {"name": "Not", "size": 1554},
                            {"name": "Or", "size": 970},
                            {"name": "Query", "size": 13896},
                            {"name": "Range", "size": 1594},
                            {"name": "StringUtil", "size": 4130},
                            {"name": "Sum", "size": 791},
                            {"name": "Variable", "size": 1124},
                            {"name": "Variance", "size": 1876},
                            {"name": "Xor", "size": 1101}
                        ]
                    },
                    {
                        "name": "scale",
                        "children": [
                            {"name": "IScaleMap", "size": 2105},
                            {"name": "LinearScale", "size": 1316},
                            {"name": "LogScale", "size": 3151},
                            {"name": "OrdinalScale", "size": 3770},
                            {"name": "QuantileScale", "size": 2435},
                            {"name": "QuantitativeScale", "size": 4839},
                            {"name": "RootScale", "size": 1756},
                            {"name": "Scale", "size": 4268},
                            {"name": "ScaleType", "size": 1821},
                            {"name": "TimeScale", "size": 5833}
                        ]
                    },
                    {
                        "name": "util",
                        "children": [
                            {"name": "Arrays", "size": 8258},
                            {"name": "Colors", "size": 10001},
                            {"name": "Dates", "size": 8217},
                            {"name": "Displays", "size": 12555},
                            {"name": "Filter", "size": 2324},
                            {"name": "Geometry", "size": 10993},
                            {
                                "name": "heap",
                                "children": [
                                    {"name": "FibonacciHeap", "size": 9354},
                                    {"name": "HeapNode", "size": 1233}
                                ]
                            },
                            {"name": "IEvaluable", "size": 335},
                            {"name": "IPredicate", "size": 383},
                            {"name": "IValueProxy", "size": 874},
                            {
                                "name": "math",
                                "children": [
                                    {"name": "DenseMatrix", "size": 3165},
                                    {"name": "IMatrix", "size": 2815},
                                    {"name": "SparseMatrix", "size": 3366}
                                ]
                            },
                            {"name": "Maths", "size": 17705},
                            {"name": "Orientation", "size": 1486},
                            {
                                "name": "palette",
                                "children": [
                                    {"name": "ColorPalette", "size": 6367},
                                    {"name": "Palette", "size": 1229},
                                    {"name": "ShapePalette", "size": 2059},
                                    {"name": "SizePalette", "size": 2291}
                                ]
                            },
                            {"name": "Property", "size": 5559},
                            {"name": "Shapes", "size": 19118},
                            {"name": "Sort", "size": 6887},
                            {"name": "Stats", "size": 6557},
                            {"name": "Strings", "size": 22026}
                        ]
                    },
                    {
                        "name": "vis",
                        "children": [
                            {
                                "name": "axis",
                                "children": [
                                    {"name": "Axes", "size": 1302},
                                    {"name": "Axis", "size": 24593},
                                    {"name": "AxisGridLine", "size": 652},
                                    {"name": "AxisLabel", "size": 636},
                                    {"name": "CartesianAxes", "size": 6703}
                                ]
                            },
                            {
                                "name": "controls",
                                "children": [
                                    {"name": "AnchorControl", "size": 2138},
                                    {"name": "ClickControl", "size": 3824},
                                    {"name": "Control", "size": 1353},
                                    {"name": "ControlList", "size": 4665},
                                    {"name": "DragControl", "size": 2649},
                                    {"name": "ExpandControl", "size": 2832},
                                    {"name": "HoverControl", "size": 4896},
                                    {"name": "IControl", "size": 763},
                                    {"name": "PanZoomControl", "size": 5222},
                                    {"name": "SelectionControl", "size": 7862},
                                    {"name": "TooltipControl", "size": 8435}
                                ]
                            },
                            {
                                "name": "data",
                                "children": [
                                    {"name": "Data", "size": 20544},
                                    {"name": "DataList", "size": 19788},
                                    {"name": "DataSprite", "size": 10349},
                                    {"name": "EdgeSprite", "size": 3301},
                                    {"name": "NodeSprite", "size": 19382},
                                    {
                                        "name": "render",
                                        "children": [
                                            {"name": "ArrowType", "size": 698},
                                            {"name": "EdgeRenderer", "size": 5569},
                                            {"name": "IRenderer", "size": 353},
                                            {"name": "ShapeRenderer", "size": 2247}
                                        ]
                                    },
                                    {"name": "ScaleBinding", "size": 11275},
                                    {"name": "Tree", "size": 7147},
                                    {"name": "TreeBuilder", "size": 9930}
                                ]
                            },
                            {
                                "name": "events",
                                "children": [
                                    {"name": "DataEvent", "size": 2313},
                                    {"name": "SelectionEvent", "size": 1880},
                                    {"name": "TooltipEvent", "size": 1701},
                                    {"name": "VisualizationEvent", "size": 1117}
                                ]
                            },
                            {
                                "name": "legend",
                                "children": [
                                    {"name": "Legend", "size": 20859},
                                    {"name": "LegendItem", "size": 4614},
                                    {"name": "LegendRange", "size": 10530}
                                ]
                            },
                            {
                                "name": "operator",
                                "children": [
                                    {
                                        "name": "distortion",
                                        "children": [
                                            {"name": "BifocalDistortion", "size": 4461},
                                            {"name": "Distortion", "size": 6314},
                                            {"name": "FisheyeDistortion", "size": 3444}
                                        ]
                                    },
                                    {
                                        "name": "encoder",
                                        "children": [
                                            {"name": "ColorEncoder", "size": 3179},
                                            {"name": "Encoder", "size": 4060},
                                            {"name": "PropertyEncoder", "size": 4138},
                                            {"name": "ShapeEncoder", "size": 1690},
                                            {"name": "SizeEncoder", "size": 1830}
                                        ]
                                    },
                                    {
                                        "name": "filter",
                                        "children": [
                                            {"name": "FisheyeTreeFilter", "size": 5219},
                                            {"name": "GraphDistanceFilter", "size": 3165},
                                            {"name": "VisibilityFilter", "size": 3509}
                                        ]
                                    },
                                    {"name": "IOperator", "size": 1286},
                                    {
                                        "name": "label",
                                        "children": [
                                            {"name": "Labeler", "size": 9956},
                                            {"name": "RadialLabeler", "size": 3899},
                                            {"name": "StackedAreaLabeler", "size": 3202}
                                        ]
                                    },
                                    {
                                        "name": "layout",
                                        "children": [
                                            {"name": "AxisLayout", "size": 6725},
                                            {"name": "BundledEdgeRouter", "size": 3727},
                                            {"name": "CircleLayout", "size": 9317},
                                            {"name": "CirclePackingLayout", "size": 12003},
                                            {"name": "DendrogramLayout", "size": 4853},
                                            {"name": "ForceDirectedLayout", "size": 8411},
                                            {"name": "IcicleTreeLayout", "size": 4864},
                                            {"name": "IndentedTreeLayout", "size": 3174},
                                            {"name": "Layout", "size": 7881},
                                            {"name": "NodeLinkTreeLayout", "size": 12870},
                                            {"name": "PieLayout", "size": 2728},
                                            {"name": "RadialTreeLayout", "size": 12348},
                                            {"name": "RandomLayout", "size": 870},
                                            {"name": "StackedAreaLayout", "size": 9121},
                                            {"name": "TreeMapLayout", "size": 9191}
                                        ]
                                    },
                                    {"name": "Operator", "size": 2490},
                                    {"name": "OperatorList", "size": 5248},
                                    {"name": "OperatorSequence", "size": 4190},
                                    {"name": "OperatorSwitch", "size": 2581},
                                    {"name": "SortOperator", "size": 2023}
                                ]
                            },
                            {"name": "Visualization", "size": 16540}
                        ]
                    }
                ]
            };
        var interGraph = $application.interactiveGraph();//.title(title).width(width);
        d3.select(selection).datum(root).call(interGraph);
    }
    var User = Backbone.Model.extend({
       defaults: {
           config: {
               name: "Guest",
               access: {
                   patches: true
               },
               textWidgets: 4,
               textKey: ["Nodes", "Patched", "Scheduled Patches", "Failed Patches"],
               graphWidgets: 3,
               graphKey: ["pie", "bar", "line"]
           }
       },
       initialize: function() {
           $('#account-dropdown').html(_.template(TEMPLATES["account/dropdownMenu"](), this.get("config")));
           $('#dashboardNav').html(_.template(TEMPLATES["dashboard/navigation"](), this.get("config")));
       }
    });
    var user = new User();
    var Properties = Backbone.Model.extend({
        defaults: {
            widgetName: "widget1",
            currentWidget: "existing",
            widgetType: "graph"
            //widgetGraph: "pie"
        },
        initialize: function () {
            'use strict';
        }
    });
    var properties = new Properties();

    var WidgetView = Backbone.View.extend({
        initialize: function () {
            'use strict';
            this.counter = 4;
            $("#size").buttonset();
            $("#graphType").buttonset();
            $("#graphdata").buttonset();
            $("#type").buttonset();
            $("#parameter").buttonset();
        },
        events: {
            'click #type1': 'graphSetting',
            'click #type2': 'textSetting',
            'click #apply': 'generate',
            'click #graphtype1': 'pieData',
            'click #graphtype2': 'otherData',
            'click #graphtype3': 'otherData',
            'click #graphtype4': 'otherData'
        },
        pieData: function () {
            $("#dataToGraph").show();
        },
        otherData: function () {
            $("#dataToGraph").hide();
        },
        generate: function () {
            $("#widgetProperties").modal('hide');
            this.render();
        },
        graphSetting: function () {
            $("#graphSettings").show();
            $("#textSettings").hide();
        },
        textSetting: function () {
            $("#graphSettings").hide();
            $("#textSettings").show();
        },
        render: function () {
            'use strict';
            var current, type, widget, sizeval, variables, graphType, graphData, graph, template, title, matches, myClass, parent, classType, index;
            current = properties.get("currentWidget");
            classType = ["info", "success", "warning", "error"];
            type = $('input:radio[name=type]:checked').val();
            if (current === "new") {
                widget = "widget" + this.counter;
                if (type === "graph") {
                    sizeval = $('input:radio[name=radio]:checked').val();
                    variables = { widget: widget,
                        span: "span" + sizeval,
                        graphcontainer: "graphcontainer" + this.counter,
                        menu: "menu" + this.counter,
                        graph: "graph" + this.counter };
                    graphType = $('input:radio[name=graph]:checked').val();
                    graphData = $('input:radio[name=graphdata]:checked').val();
                    // Compile the template using underscore
                    template = _.template($("#widget_template").html(), variables);
                    // Load the compiled HTML into the Backbone "el"
                    $("#insert").append(template);
                    this.counter += 1;
                    graph = "#" + $("#" + widget).children().children("div").attr("id");
                    if (graphType === "pie") {
                        pieGraph(graph, graphData);
                    } else if (graphType === "bar") {
                        barGraph(graph);
                    } else if (graphType === "line") {
                        lineGraph(graph);
                    } else if (graphType === "time") {
                        cubismGraph(graph);
                    }
                } else {
                    sizeval = "3";
                    title = $('input:[name=param]:checked');
                    index =  $("input:radio[name='param']").index(title);
                    title = title.val();
                    variables = { widget: widget, span: "span" + sizeval, type: classType[index], title: title, data: Math.floor(Math.random() * 500) };
                    template = _.template($("#text_template").html(), variables);
                    $("#insert").append(template);
                    this.counter += 1;
                }
                //Pass variables in using Underscore.js Template

            } else {
                widget = properties.get("widgetName");
                if (type === "graph") {
                    myClass = $("#" + widget).attr("class");
                    sizeval = $('input:radio[name=radio]:checked').val();
                    graph = "#" + $("#" + widget).children().children("div").attr("id");
                    graphType = $('input:radio[name=graph]:checked').val();
                    graphData = $('input:radio[name=graphdata]:checked').val();
                    $("#" + widget).removeClass(myClass);
                    $("#" + widget).addClass("span" + sizeval + " widget");
                    if (graphType === "pie") {
                        //createPie(graph, graphData);
                        pieGraph(graph, graphData);
                    } else if (graphType === "bar") {
                        barGraph(graph);
                    } else if (graphType === "line") {
                        lineGraph(graph);
                    } else if (graphType === "time") {
                        stackedGraph(graph);
                    }
                } else {
                    parent = $("#" + widget).parent();
                    title = $('input:[name=param]:checked');
                    index =  $("input:radio[name='param']").index(title);
                    title = title.val();
                    sizeval = "3";
                    variables = { widget: widget, span: "span" + sizeval, title: title, type: classType[index], data: Math.floor(Math.random() * 500) };
                    template = _.template($("#text_template").html(), variables);
                    $("#" + widget).remove();
                    $(parent).append(template);
                }
            }
        }
    });
    var widgetview = new WidgetView({ el: 'body' });

    function setProperties(obj, param) {
        'use strict';
        if (param === "existing") {
            properties.set({
                widgetName: $(obj).parent().parent().parent().parent().parent().parent().attr("id"),
                currentWidget: "existing"
            });
        } else if (param === "new") {
            properties.set({
                currentWidget: "new"
            });
        }
    }
    function hideWidget(obj) {
        'use strict';
        $(obj).parent().parent().parent().parent().parent().parent().hide();
    }
    $(".dropdown-toggle").dropdown();
    $(".movable").sortable({ connectWith: '.movable' });
    $("#restore").click(function () { $(".widget").show(); });
    $("#deploy").click(function () {
        var variables = { type: "patches" };
        var template = _.template($("#patch_template").html(), variables);
        $("#main").html(template);
    });
    pieGraph("#graph1", "os");
    barGraph("#graph2");
    interactiveGraph("#graph3");
    //stackedGraph("#graph3");
    //lineGraph("#graph3");
    //cubismGraph("#graph3");
</script>



<!--/Top Patch javascript -->

</body>
</html>